{% extends 'base.html' %}

{% block content %}

<div id="app">
  <div :class="{'finish': isFinish}">
    <div class="d-flex justify-content-around">
      <div class="left d-flex flex-column">
        <label><input type="checkbox" v-model="checked" value="액션" :disabled="checked.length > 1 ">  액션</label>
        <label><input type="checkbox" v-model="checked" value="모험" :disabled="checked.length > 1 ">  모험</label>
        <label><input type="checkbox" v-model="checked" value="애니메이션" :disabled="checked.length > 1 ">  애니메이션</label>
        <label><input type="checkbox" v-model="checked" value="코미디" :disabled="checked.length > 1 ">  코미디</label>
        <label><input type="checkbox" v-model="checked" value="범죄" :disabled="checked.length > 1 ">  범죄</label>
        <label><input type="checkbox" v-model="checked" value="다큐멘터리" :disabled="checked.length > 1 ">  다큐멘터리</label>
        <label><input type="checkbox" v-model="checked" value="드라마" :disabled="checked.length > 1 ">  드라마</label>
        <label><input type="checkbox" v-model="checked" value="가족" :disabled="checked.length > 1 ">  가족</label>
        <label><input type="checkbox" v-model="checked" value="판타지" :disabled="checked.length > 1 ">  판타지</label>
      </div>
      
      <div class="right d-flex flex-column">
        <label><input type="checkbox" v-model="checked" value="역사" :disabled="checked.length > 1 ">  역사</label>
        <label><input type="checkbox" value="공포" v-model="checked" :disabled="checked.length > 1 ">  공포</label>
        <label><input type="checkbox" value="음악" v-model="checked" :disabled="checked.length > 1 ">  음악</label>
        <label><input type="checkbox" value="미스터리" v-model="checked" :disabled="checked.length > 1 ">  미스터리</label>
        <label><input type="checkbox" value="로맨스" v-model="checked" :disabled="checked.length > 1 ">  로맨스</label>
        <label><input type="checkbox" value="SF" v-model="checked" :disabled="checked.length > 1 ">  SF</label>
        <label><input type="checkbox" value="스릴러" v-model="checked" :disabled="checked.length > 1 ">  스릴러</label>
        <label><input type="checkbox" value="전쟁" v-model="checked" :disabled="checked.length > 1 ">  전쟁</label>
        <label><input type="checkbox" value="서부" v-model="checked" :disabled="checked.length > 1 ">  서부</label>
      </div>
    </div>
    <button
    class="btn btn-primary recom-button"
    @click="getRecommendation"
    >장르별 추천 받기!</button>
  </div>

  <div :class="{'start' : isStart}">
    <h1 style="display:block;">선택하신 항목과 가장 일치합니다</h1>
    <div class="text-center d-flex flex-wrap justify-content-around">
      <div v-for="(movie, idx) in bestMovie">
        <div class="card mt-4" style="width: 11rem; height: 23rem;">
          <img :src="movie.movieImgUrl" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">({movie.movieTitle})</h5>
            <p class="card-text">({movie.movieRate})</p>
          </div>
        </div>
      </div>
    </div>
  
    <hr>
  
    <h1 style="display:block;">좋아하실 수 있습니다</h1>
    <div class="text-center d-flex flex-wrap justify-content-around">
      <div v-for="(movie, idx) in firstMovie">
        <div class="card mt-4" style="width: 11rem; height: 23rem;">
          <img :src="movie.movieImgUrl" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">({movie.movieTitle})</h5>
            <p class="card-text">({movie.movieRate})</p>
          </div>
        </div>
      </div>
    </div>
  
    <hr>
  
    <h1 style="display:block;"> 좋아하실 수 있습니다</h2>
    <div class="text-center d-flex flex-wrap justify-content-around">
      <div v-for="(movie, idx) in secondMovie">
        <div class="card mt-4" style="width: 11rem; height: 23rem;">
          <img :src="movie.movieImgUrl" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">({movie.movieTitle})</h5>
            <p class="card-text">({movie.movieRate})</p>
          </div>
        </div>
      </div>
    </div>

  </div>

</div>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
  <script>
    const RECOM_URL = "http://127.0.0.1:8000/movies/recommendation"
    const app = new Vue({
      delimiters: ['({', '})'],
      el: '#app',
      data: {
        checked: [],
        bestMovie: [],
        firstMovie: [],
        secondMovie: [],
        isFinish: false,
        isStart: true,
      },
      methods: {
        getRecommendation: function () {
          const getData = `${RECOM_URL}/${this.checked[0]}/${this.checked[1]}/`
          axios.get(getData)
            .then(res => {
              console.log(res.data['firstMovie'][0].movieTitle)
              // console.log(res.data['bestMovie'].length)
              if (res.data['bestMovie'].length){
                for (let i = 0; i < res.data['bestMovie'].length; i++) {
                  this.bestMovie.push(res.data['bestMovie'][i])
                }
                for (let i = 0; i < res.data['firstMovie'].length; i++) {
                  this.firstMovie.push(res.data['firstMovie'][i])
                  console.log(res.data['firstMovie'][i])
                }
                for (let i =0; i < res.data['secondMovie'].length; i++) {
                  this.secondMovie.push(res.data['secondMovie'][i])
                }

              } else {
                for (let i = 0; i < res.data['firstMovie'].length; i++) {
                  this.firstMovie.push(res.data['firstMovie'][i])
                }
                for (let i =0; i < res.data['secondMovie'].length; i++) {
                  this.secondMovie.push(res.data['secondMovie'][i])
                }
              }
              // console.log(this.firstMovie)
              this.isFinish = true
              this.isStart = false

            })
            .catch(err => {console.log(err)})
        }
      }
    })

  </script>

{% endblock content %}